import{u as F,g as O,r as t,j as e,T as q,B as l,n as v,m as f,a3 as w,c as j,a4 as z,a5 as U,a6 as B,a7 as $}from"./index-iSoaFn0Q.js";import{C as H,d as M}from"./card-B6ngMx-y.js";import{A as G,a as J,b as K}from"./avatar-BfhNjtcc.js";import{I as Q}from"./input-Dpv_YrRF.js";import{L as x}from"./label-DQ7xA-QL.js";import{T as V}from"./textarea-BY4mOd8v.js";import{D as W,a as X,b as Y,c as Z,d as _,f as ee}from"./dialog-VvPmQMWr.js";import"./index-C5_67qQV.js";const N=[{id:"way",label:"في الطريق",icon:v},{id:"arrived",label:"وصلت للموقع",icon:f},{id:"working",label:"جاري العمل",icon:w},{id:"completed",label:"تم الإنجاز",icon:f}];function oe(){const y=F(),k=O(),{request:r}=k.state||{},[i,C]=t.useState("way"),[c,I]=t.useState(0),[h,u]=t.useState(!1),[S,b]=t.useState(!1),[g,T]=t.useState(""),[P,D]=t.useState(""),[p,R]=t.useState([]);t.useEffect(()=>{let s;return h&&(s=setInterval(()=>{I(a=>a+1)},1e3)),()=>clearInterval(s)},[h]);const o=s=>{const a=Math.floor(s/60),n=s%60;return`${a.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},d=s=>{s==="working"?u(!0):s==="completed"&&u(!1),C(s)},A=s=>{const n=Array.from(s.target.files).map(m=>URL.createObjectURL(m));R([...p,...n])},L=()=>{y("/technician/payment-confirmation",{state:{request:r,duration:o(c),finalPrice:g||r?.price}})};return r?e.jsxs("div",{className:"min-h-screen bg-linear-to-br from-slate-50 to-slate-100/50 dark:from-slate-950 dark:to-slate-900 pb-24",dir:"rtl",children:[e.jsx("div",{className:"bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 sticky top-0 z-50 p-4",children:e.jsxs("div",{className:"container max-w-md mx-auto flex items-center justify-between",children:[e.jsx("h1",{className:"font-bold text-lg",children:"متابعة المهمة"}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-100 dark:bg-slate-800 px-3 py-1 rounded-full text-sm font-mono",children:[e.jsx(q,{className:"w-4 h-4 text-primary"}),o(c)]})]})}),e.jsxs("div",{className:"container max-w-md mx-auto p-4 space-y-6",children:[e.jsx(H,{className:"border-0 shadow-lg",children:e.jsxs(M,{className:"p-4 flex items-center gap-4",children:[e.jsxs(G,{className:"w-12 h-12",children:[e.jsx(J,{src:r.customer.image}),e.jsx(K,{children:r.customer.name[0]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold",children:r.customer.name}),e.jsx("p",{className:"text-sm text-slate-500",children:r.location.address})]}),e.jsx(l,{size:"icon",className:"rounded-full bg-green-500 hover:bg-green-600",children:e.jsx(v,{className:"w-5 h-5 text-white"})})]})}),e.jsxs("div",{className:"flex justify-between relative px-4",children:[e.jsx("div",{className:"absolute top-1/2 left-4 right-4 h-1 bg-slate-200 dark:bg-slate-800 -z-10 -translate-y-1/2"}),N.map((s,a)=>{const n=s.id===i,m=N.findIndex(E=>E.id===i)>=a;return e.jsxs("div",{className:"flex flex-col items-center gap-2 bg-white dark:bg-slate-950 p-2 rounded-xl",children:[e.jsx("div",{className:j("w-10 h-10 rounded-full flex items-center justify-center border-4 transition-all",n?"bg-primary border-primary text-white scale-110":m?"bg-green-500 border-green-500 text-white":"bg-slate-100 border-slate-200 text-slate-400"),children:e.jsx(s.icon,{className:"w-5 h-5"})}),e.jsx("span",{className:j("text-xs font-bold",n?"text-primary":"text-slate-500"),children:s.label})]},s.id)})]}),e.jsxs("div",{className:"space-y-4",children:[i==="way"&&e.jsxs("div",{className:"text-center space-y-4 animate-in fade-in slide-in-from-bottom-4",children:[e.jsx("div",{className:"aspect-video bg-slate-200 dark:bg-slate-800 rounded-2xl flex items-center justify-center",children:e.jsx("p",{className:"text-slate-500",children:"خريطة التوجه للعميل"})}),e.jsx(l,{onClick:()=>d("arrived"),className:"w-full h-14 text-lg font-bold rounded-xl shadow-lg shadow-primary/20",children:"وصلت للموقع"})]}),i==="arrived"&&e.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-bottom-4",children:[e.jsx("div",{className:"bg-blue-50 dark:bg-blue-950/30 p-4 rounded-xl border border-blue-100 dark:border-blue-900 text-blue-800 dark:text-blue-200 text-sm",children:"يرجى فحص المشكلة وتحديد ما إذا كان السعر المتفق عليه مناسباً أم يحتاج لتعديل."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(W,{open:S,onOpenChange:b,children:[e.jsx(X,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:"h-14 font-bold rounded-xl border-2",children:[e.jsx(z,{className:"w-5 h-5 ml-2"})," تعديل السعر"]})}),e.jsxs(Y,{dir:"rtl",children:[e.jsx(Z,{children:e.jsx(_,{children:"تعديل سعر الخدمة"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"السعر الجديد"}),e.jsx(Q,{type:"number",placeholder:"مثال: 350",value:g,onChange:s=>T(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"سبب التعديل"}),e.jsx(V,{placeholder:"اشرح سبب زيادة السعر...",value:P,onChange:s=>D(s.target.value)})]})]}),e.jsx(ee,{children:e.jsx(l,{onClick:()=>b(!1),children:"حفظ التعديلات"})})]})]}),e.jsxs(l,{onClick:()=>d("working"),className:"h-14 font-bold rounded-xl shadow-lg shadow-primary/20",children:[e.jsx(w,{className:"w-5 h-5 ml-2"})," بدء العمل"]})]})]}),i==="working"&&e.jsxs("div",{className:"text-center space-y-6 animate-in fade-in slide-in-from-bottom-4",children:[e.jsxs("div",{className:"w-40 h-40 mx-auto rounded-full border-8 border-primary/20 flex items-center justify-center relative",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-t-8 border-primary animate-spin"}),e.jsx("div",{className:"text-3xl font-mono font-bold text-primary",children:o(c)})]}),e.jsx("p",{className:"text-slate-500",children:"جاري تنفيذ المهمة..."}),e.jsxs(l,{onClick:()=>d("completed"),variant:"destructive",className:"w-full h-14 text-lg font-bold rounded-xl",children:[e.jsx(U,{className:"w-5 h-5 ml-2"})," إنهاء العمل"]})]}),i==="completed"&&e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(x,{className:"text-base",children:"إثبات الإنجاز (صور)"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[p.map((s,a)=>e.jsx("div",{className:"aspect-square rounded-xl overflow-hidden border border-slate-200",children:e.jsx("img",{src:s,alt:"Proof",className:"w-full h-full object-cover"})},a)),e.jsxs("label",{className:"aspect-square rounded-xl border-2 border-dashed border-slate-300 dark:border-slate-700 flex flex-col items-center justify-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:[e.jsx(B,{className:"w-8 h-8 text-slate-400"}),e.jsx("span",{className:"text-xs text-slate-500 mt-2",children:"أضف صورة"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",onChange:A})]})]})]}),e.jsxs(l,{onClick:L,className:"w-full h-14 text-lg font-bold rounded-xl bg-green-600 hover:bg-green-700 shadow-lg shadow-green-900/20",children:[e.jsx($,{className:"w-5 h-5 ml-2"})," إرسال وتأكيد"]})]})]})]})]}):null}export{oe as default};
